<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Login</title>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js">
        </script>
        <script src="https://apis.google.com/js/client:platform.js?onload=start" async defer>
        </script>
    </head>
    <body>
        <!-- Google plus sign in --->
        <div id="signinButtonG">
            <span class="g-signin"
             data-scope="openid email"
             data-clientid="114540178835-ggtn3814f920q2ai40f5df67q0oc0nui.apps.googleusercontent.com"
             data-redirecturi="postmessage"
             data-accesstype="offline"
             data-cookiepolicy="single_host_origin"
             data-callback="gSignInCallback"
             data-approvalprompt="force">
            </span>
        </div>
        <div id="result"></div>
        
        <script>
            function gSignInCallback(authResult){
                if(authResult.code){
                    // Hide the signin button now that the user is authenticated/authorized
                    $('#signinButtonG').attr('style', 'display:none');
                    //$('#signinButtonFB').attr('style', 'display:none');
                    
                    /* Send the onetime-use-code to the server, if the server responds,
                     write a 'login successful' message to the web page and redirect back 
                     to the main restaurants page. */
                    $.ajax({
                        type: 'POST',
                        url: '/gconnect?state={{STATE}}',
                        processData: false,
                        contentType: 'application/octet-stream; charset=utf-8',
                        data: authResult.code,
                        success: function(result){
                                $('#result').html(result + '</br>Redirecting...');
                                setTimeout(function(){
                                    window.location.href = '/restaurants';
                                }, 3000);
                        }
                    });
                } 
            }  
        </script>        
        <!-- End Google plus sign in -->
       
    </body>
</html>